description: Configure SSH host key settings for telemetry collection
parameters:
  targets:
    type: TargetSpec
    description: A list of targets to apply this plan on
  ssh_config_content:
    type: String
    default: |
      Host *
          StrictHostKeyChecking no
          UserKnownHostsFile /dev/null

steps:
  - name: all_targets
    eval: get_targets($targets)

  - block:
      - apply_prep: $all_targets

      - resources:
          - type: file
            title: "${::home}/.ssh"
            parameters:
              ensure: directory
              owner: $::user
              group: $::group
              mode: '0700'
          - type: file
            title: "${::home}/.ssh/config"
            parameters:
              ensure: file
              owner: $::user
              group: $::group
              mode: '0600'
              content: $ssh_config_content

      - name: notify_ssh_config
        eval: "Notify { 'SSH Configuration - ${var_node} Applied Successfully!': withpath => false }"
    target: $all_targets

return: $notify_ssh_config
